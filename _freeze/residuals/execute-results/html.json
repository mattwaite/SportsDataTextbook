{
  "hash": "eae19dc5c8e762be29fac4ce8830d669",
  "result": {
    "markdown": "# Residuals\n\nWhen looking at a linear model of your data, there's a measure you need to be aware of called residuals. The residual is the distance between what the model predicted and what the real outcome is. Take our model at the end of the correlation and regression chapter. Our model predicted Nebraska, given a 5 net yardage margin would beat Iowa by 1.96 points. They lost by 6. So our residual is -7.96.\n\nResiduals can tell you several things, but most important is if a linear model the right model for your data. If the residuals appear to be random, then a linear model is appropriate. If they have a pattern, it means something else is going on in your data and a linear model isn't appropriate.\n\nResiduals can also tell you who is underperforming and overperforming the model. And the more robust the model -- the better your r-squared value is -- the more meaningful that label of under or overperforming is.\n\nLet's go back to our net yards model.\n\n\n<pre><p><strong>For this walkthrough:</strong></p><p><a href=\"http://mattwaite.github.io/sportsdatafiles/footballlogs20.csv\">\n  <button class=\"btn btn-danger\"><i class=\"fa fa-save\"></i> Download csv file</button>\n</a></p></pre>\n\n\nThen load the tidyverse.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlogs <- read_csv(\"data/footballlogs20.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 1100 Columns: 54\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): HomeAway, Opponent, Result, TeamFull, TeamURL, Outcome, Team, Con...\ndbl  (45): Game, PassingCmp, PassingAtt, PassingPct, PassingYds, PassingTD, ...\ndate  (1): Date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\nFirst, let's make the columns we'll need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresidualmodel <- logs |> mutate(differential = TeamScore - OpponentScore, NetYards = OffensiveYards - DefYards)\n```\n:::\n\n\nNow let's create our model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- lm(differential ~ NetYards, data = residualmodel)\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = differential ~ NetYards, data = residualmodel)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-49.479  -8.593   0.128   8.551  48.857 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 0.311030   0.385651   0.807     0.42    \nNetYards    0.101704   0.002293  44.345   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.78 on 1098 degrees of freedom\nMultiple R-squared:  0.6417,\tAdjusted R-squared:  0.6414 \nF-statistic:  1967 on 1 and 1098 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nWe've seen this output before, but let's review because if you are using scatterplots to make a point, you should do this. First, note the Min and Max residual at the top. A team has underperformed the model by nearly 50 points (!), and a team has overperformed it by 49 points (!!). The median residual, where half are above and half are below, is just slightly above the fit line. Close here is good.\n\nNext: Look at the Adjusted R-squared value. What that says is that 64 percent of a team's scoring output can be predicted by their net yards.\n\nLast: Look at the p-value. We are looking for a p-value smaller than .05. At .05, we can say that our correlation didn't happen at random. And, in this case, it REALLY didn't happen at random. But if you know a little bit about football, it doesn't surprise you that the more you outgain your opponent, the more you win by. It's an intuitive result.\n\nWhat we want to do now is look at those residuals. We want to add them to our individual game records. We can do that by creating two new fields -- predicted and residuals -- to our dataframe like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresidualmodel <- residualmodel |> mutate(predicted = predict(fit), residuals = residuals(fit))\n```\n:::\n\n\nNow we can sort our data by those residuals. Sorting in descending order gives us the games where teams overperformed the model. To make it easier to read, I'm going to use select to give us just the columns we need to see.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresidualmodel |> arrange(desc(residuals)) |> select(Team, Opponent, Result, differential, NetYards, predicted, residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,100 × 7\n   Team              Opponent   Result differential NetYards predicted residuals\n   <chr>             <chr>      <chr>         <dbl>    <dbl>     <dbl>     <dbl>\n 1 Arizona State     Arizona    W (70…           63      136     14.1       48.9\n 2 Wisconsin         Wake Fore… W (42…           14     -252    -25.3       39.3\n 3 Kentucky          Mississip… W (24…           22     -138    -13.7       35.7\n 4 Mississippi State Vanderbilt W (24…            7     -274    -27.6       34.6\n 5 Kansas State      Kansas     W (55…           41       61      6.51      34.5\n 6 Boise State       Colorado … W (52…           31      -24     -2.13      33.1\n 7 Army              Mercer     W (49…           46      139     14.4       31.6\n 8 Notre Dame        South Flo… W (52…           52      198     20.4       31.6\n 9 Texas             Oklahoma … W (41…            7     -243    -24.4       31.4\n10 BYU               North Ala… W (66…           52      201     20.8       31.2\n# ℹ 1,090 more rows\n```\n:::\n:::\n\n\nSo looking at this table, what you see here are the teams who scored more than their net yards would indicate. One of them should jump off the page at you.\n\nRemember Nebraska vs Rutgers? We won and everyone was happy and relieved the season was over? We outgained Rutgers by **368 yards** in that game and won by 7. Our model predicted Nebraska should have won that game by **37** points. We should have blown Rutgers out of their own barn. But Rutgers isn't as hard done as Arizona, which should have lost by 48, but ended up losing by 63.\n\nBut, before we can bestow any validity on this model, we need to see if this linear model is appropriate. We've done that some looking at our p-values and R-squared values. But one more check is to look at the residuals themselves. We do that by plotting the residuals with the predictor. We'll get into plotting soon, but for now just seeing it is enough.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](residuals_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nThe lack of a shape here -- the seemingly random nature -- is a good sign that a linear model works for our data. If there was a pattern, that would indicate something else was going on in our data and we needed a different model.\n\nAnother way to view your residuals is by connecting the predicted value with the actual value.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](residuals_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nThe blue line here separates underperformers from overperformers.\n\n## Penalties\n\nNow let's look at it where it doesn't work: Penalties.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenalties <- logs |> \n  mutate(\n    differential = TeamScore - OpponentScore, \n    TotalPenalties = Penalties+DefPenalties,\n    TotalPenaltyYards = PenaltyYds+DefPenaltyYds\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npfit <- lm(differential ~ TotalPenaltyYards, data = penalties)\nsummary(pfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = differential ~ TotalPenaltyYards, data = penalties)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-67.007 -14.699   0.265  14.047  64.993 \n\nCoefficients:\n                  Estimate Std. Error t value Pr(>|t|)\n(Intercept)        1.21614    1.79282   0.678    0.498\nTotalPenaltyYards -0.00349    0.01556  -0.224    0.823\n\nResidual standard error: 21.36 on 1098 degrees of freedom\nMultiple R-squared:  4.58e-05,\tAdjusted R-squared:  -0.0008649 \nF-statistic: 0.05029 on 1 and 1098 DF,  p-value: 0.8226\n```\n:::\n:::\n\n\nSo from top to bottom:\n\n-   Our min and max go from -67 to positive 65\n-   Our adjusted R-squared is ... -0.0008935. Not much at all.\n-   Our p-value is ... 0.8307, which is more than than .05.\n\nSo what we can say about this model is that it's statistically insignificant and utterly meaningless. Normally, we'd stop right here -- why bother going forward with a predictive model that isn't predictive? But let's do it anyway.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenalties$predicted <- predict(pfit)\npenalties$residuals <- residuals(pfit)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenalties |> arrange(desc(residuals)) |> select(Team, Opponent, Result, TotalPenaltyYards, residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,100 × 5\n   Team          Opponent         Result    TotalPenaltyYards residuals\n   <chr>         <chr>            <chr>                 <dbl>     <dbl>\n 1 Clemson       Georgia Tech     W (73-7)                 60      65.0\n 2 Arizona State Arizona          W (70-7)                119      62.2\n 3 Alabama       Kentucky         W (63-3)                 99      59.1\n 4 Marshall      Eastern Kentucky W (59-0)                 55      58.0\n 5 Texas         Texas-El Paso    W (59-3)                 85      55.1\n 6 Pitt          Austin Peay      W (55-0)                 57      54.0\n 7 Oklahoma      Kansas           W (62-9)                100      52.1\n 8 Wake Forest   Campbell         W (66-14)                82      51.1\n 9 BYU           North Alabama    W (66-14)                74      51.0\n10 Notre Dame    South Florida    W (52-0)                 65      51.0\n# ℹ 1,090 more rows\n```\n:::\n:::\n\n\nFirst, note all of the biggest misses here are all blowout games. The worst games of the season, the worst being Clemson vs Georgia Tech. The model missed that differential by ... 65 points. The margin of victory? 66 points. In other words, this model is terrible. But let's look at it anyway.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](residuals_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nWell ... it actually says that a linear model is appropriate. Which an important lesson -- just because your residual plot says a linear model works here, that doesn't say your linear model is good. There are other measures for that, and you need to use them.\n\nHere's the segment plot of residuals -- you'll see some really long lines. That's a bad sign. Another bad sign? A flat fit line. It means there's no relationship between these two things. Which we already know.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](residuals_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "residuals_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}