{
  "hash": "8f024fefc5aa8cd3730a6d455c3baec5",
  "result": {
    "markdown": "# Line charts\n\nSo far, we've talked about bar charts -- stacked or otherwise -- are good for showing relative size of a thing compared to another thing. Stacked Bars and Waffle charts are good at showing proportions of a whole. \n\n**Line charts are good for showing change over time.** \n\nLet's look at how we can answer this question: Why was Nebraska terrible at basketball last season?\n\nWe'll need the logs of every game in college basketball for this.\n\n\n\n<pre><p><strong>For this walkthrough:</strong></p><p><a href=\"http://mattwaite.github.io/sportsdatafiles/logs21.csv\">\n  <button class=\"btn btn-danger\"><i class=\"fa fa-save\"></i> Download csv file</button>\n</a></p></pre>\n\n\n\nLet's start getting all that we need. We can use the tidyverse shortcut. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n\nAnd now load the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogs <- read_csv(\"data/logs21.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 8229 Columns: 48\n-- Column specification --------------------------------------------------------\nDelimiter: \",\"\nchr   (8): Season, TeamFull, Opponent, HomeAway, W_L, URL, Conference, Team\ndbl  (39): Game, TeamScore, OpponentScore, TeamFG, TeamFGA, TeamFGPCT, Team3...\ndate  (1): Date\n\ni Use `spec()` to retrieve the full column specification for this data.\ni Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n\nThis data has every game from every team in it, so we need to use filtering to limit it, because we just want to look at Nebraska. If you don't remember, flip back to chapter 6. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnu <- logs %>% filter(Team == \"Nebraska\")\n```\n:::\n\n\n\nBecause this data has just Nebraska data in it, the dates are formatted correctly, and the data is long data (instead of wide), we have what we need to make line charts.\n\nLine charts, unlike bar charts, do have a y-axis. So in our ggplot step, we have to define what our x and y axes are. In this case, the x axis is our Date -- the most common x axis in line charts is going to be a date of some variety -- and y in this case is up to us. We've seen from previous walkthroughs that how well a team shoots the ball has a lot to do with how well a team does in a season, so let's chart that. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + geom_line(data=nu, aes(x=Date, y=TeamFGPCT))\n```\n\n::: {.cell-output-display}\n![](linecharts_files/figure-pdf/unnamed-chunk-5-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nSee some problems here? The first you'll probably see is the long COVID pause the team had to take. The real problem, though is that the Y axis doesn't start with zero. That makes this look more dramatic than it is. To make the axis what you want, you can use `scale_x_continuous` or `scale_y_continuous` and pass in a list with the bottom and top value you want. You do that like this:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data=nu, aes(x=Date, y=TeamFGPCT)) + \n  scale_y_continuous(limits = c(0, .6))\n```\n\n::: {.cell-output-display}\n![](linecharts_files/figure-pdf/unnamed-chunk-6-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nNote also that our X axis labels are automated. It knows it's a date and it just labels it by month.\n\n## This is too simple. \n\nWith datasets, we want to invite comparison. So let's answer the question visually. Let's put two lines on the same chart. How does Nebraska compare to Michigan State, for example? \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmsu <- logs %>% filter(Team == \"Michigan State\")\n```\n:::\n\n\n\nIn this case, because we have two different datasets, we're going to put everything in the geom instead of the ggplot step. We also have to explicitly state what dataset we're using by saying `data=` in the geom step.\n\nFirst, let's chart Nebraska. Read carefully. First we set the data. Then we set our aesthetic. Unlike bars, we need an X and a Y variable. In this case, our X is the date of the game, Y is the thing we want the lines to move with. In this case, the Team Field Goal Percentage -- TeamFGPCT. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + geom_line(data=nu, aes(x=Date, y=TeamFGPCT), color=\"red\")\n```\n\n::: {.cell-output-display}\n![](linecharts_files/figure-pdf/unnamed-chunk-8-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nNow, by using +, we can add Michigan State to it. REMEMBER COPY AND PASTE IS A THING. Nothing changes except what data you are using.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data=nu, aes(x=Date, y=TeamFGPCT), color=\"red\") + \n  geom_line(data=msu, aes(x=Date, y=TeamFGPCT), color=\"green\")\n```\n\n::: {.cell-output-display}\n![](linecharts_files/figure-pdf/unnamed-chunk-9-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nLet's flatten our lines out by zeroing the Y axis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data=nu, aes(x=Date, y=TeamFGPCT), color=\"red\") + \n  geom_line(data=msu, aes(x=Date, y=TeamFGPCT), color=\"green\") + \n  scale_y_continuous(limits = c(0, .65))\n```\n\n::: {.cell-output-display}\n![](linecharts_files/figure-pdf/unnamed-chunk-10-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nSo visually speaking, the difference between Nebraska and Michigan State's season is that Michigan State stayed mostly on an even keel, and Nebraska went on a two month swoon.\n\n## But what if I wanted to add a lot of lines. \n\nFine. How about all Power Five Schools? This data for example purposes. You don't have to do it. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npowerfive <- c(\"SEC\", \"Big Ten\", \"Pac-12\", \"Big 12\", \"ACC\")\n\np5conf <- logs %>% filter(Conference %in% powerfive)\n```\n:::\n\n\n\nI can keep layering on layers all day if I want. And if my dataset has more than one team in it, I need to use the `group` command. And, the layering comes in order -- so if you're going to layer a bunch of lines with a smaller group of lines, you want the bunch on the bottom. So to do that, your code stacks from the bottom. The first geom in the code gets rendered first. The second gets layered on top of that. The third gets layered on that and so on. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data=p5conf, aes(x=Date, y=TeamFGPCT, group=Team), color=\"grey\") + \n  geom_line(data=nu, aes(x=Date, y=TeamFGPCT), color=\"red\") + \n  geom_line(data=msu, aes(x=Date, y=TeamFGPCT), color=\"green\") + \n  scale_y_continuous(limits = c(0, .65))\n```\n\n::: {.cell-output-display}\n![](linecharts_files/figure-pdf/unnamed-chunk-12-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nWhat do we see here? How has Nebraska and Michigan State's season evolved against all the rest of the teams in college basketball?\n\nBut how does that compare to the average? We can add that pretty easily by creating a new dataframe with it and add another geom_line.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naverage <- logs %>% group_by(Date) %>% summarise(mean_shooting=mean(TeamFGPCT))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data=p5conf, aes(x=Date, y=TeamFGPCT, group=Team), color=\"grey\") + \n  geom_line(data=nu, aes(x=Date, y=TeamFGPCT), color=\"red\") + \n  geom_line(data=msu, aes(x=Date, y=TeamFGPCT), color=\"green\") + \n  geom_line(data=average, aes(x=Date, y=mean_shooting), color=\"black\") + \n  scale_y_continuous(limits = c(0, .65))\n```\n\n::: {.cell-output-display}\n![](linecharts_files/figure-pdf/unnamed-chunk-14-1.pdf){fig-pos='H'}\n:::\n:::\n",
    "supporting": [
      "linecharts_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}